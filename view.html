<!DOCTYPE html>
<head>
    <meta charset="UTF-8"/>
    <title>Averages</title>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/latest/css/bootstrap.min.css"/>
    <script src="averages.js"></script>
</head>
<body style="overflow:hidden;">
    <div>
        <div style="display:inline-block;width:40%;">
        <div style="display: inline-block;">
            <textarea id="numbers" style="width: 300px; height: 480px;"></textarea>
            
        <div>
            <button onclick="update()">update</button>
        </div>
    
        <div>
            <div>
                <input id="gen-len" type="number" value="20" />
            </div>
            <div>
                <input id="gen-dense" type="number" value="3" />
            </div>
            <div>
                <button onclick="generate()">generate</button>
            </div>
        </div>
    
        </div>
 
        <div style="display: inline-block; vertical-align: top">

            <div>
                <p>median</p>
                <textarea id="median"></textarea>
            </div>

            <div>
                <p>sma</p>
                <textarea id="sma"></textarea>
            </div>

            <div>
                <p>wma</p>
                <textarea id="wma"></textarea>
            </div>

            <div>
                <p>ema</p>
                <textarea id="ema"></textarea>
            </div>

            <div>
                <p>ema2</p>
                <textarea id="ema2"></textarea>
            </div>
    
            <div>
                <p>ema3</p>
                <textarea id="ema3"></textarea>
            </div>

        </div>
        </div>
        <div style="display:inline-block; width:59%; height: 100vh;">
        <div style="width:75%;"><div class="chartjs-size-monitor" style="position: absolute; left: 0px; top: 0px; right: 0px; bottom: 0px; overflow: hidden; pointer-events: none; visibility: hidden; z-index: -1;"><div class="chartjs-size-monitor-expand" style="position:absolute;left:0;top:0;right:0;bottom:0;overflow:hidden;pointer-events:none;visibility:hidden;z-index:-1;"><div style="position:absolute;width:1000000px;height:1000000px;left:0;top:0"></div></div><div class="chartjs-size-monitor-shrink" style="position:absolute;left:0;top:0;right:0;bottom:0;overflow:hidden;pointer-events:none;visibility:hidden;z-index:-1;"><div style="position:absolute;width:200%;height:200%;left:0; top:0"></div></div></div>
            <canvas id="canvas" width="1530" height="1580" class="chartjs-render-monitor" style="display: block; width: 1430px; height: 715px;"></canvas>
        </div>
        </div>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.7.2/Chart.bundle.js"></script>
                
        <script>
            let dataLine = [ 1, 2, 3, 4 ];
            let dataDot = [
                { x: 1, y: 2 },
                { x: 1, y: 3 },
                { x: 2, y: 2 },
                { x: 2, y: 20 },
            ];
            let xLength = Array(dataLine.length).keys();
            let yLength = Math.max.apply(null, dataDot.map(item => item.y).concat(dataLine))+1;
            let config = {
                type: 'line',
                data: {
                    labels: [...xLength],
                    datasets: [{
                        label: 'Absolute comission',
                        backgroundColor: '#000000',
                        borderColor: '#4286f4',
                        data: dataLine,
                        fill: false,
                    },
                    { 
                        showLine: false,
                        label: 'Commision of users',
                        backgroundColor: '#ba1448',
                        borderColor: '#4286f4',
                        data: dataDot,
                        fill: false,
                    }]
                },
                options: {
                    responsive: true,
                    title: {
                        display: true,
                        text: 'Time and commision of BC'
                    },
                    tooltips: {
                        mode: 'point',
                        intersect: false,
                    },
                    hover: {
                        mode: 'nearest',
                        intersect: true
                    },
                    scales: {
                        xAxes: [{
                            display: true,
                            scaleLabel: {
                                display: true,
                                labelString: 'Time'
                            }
                        }],
                        yAxes: [{
                            display: true,
                            scaleLabel: {
                                display: true,
                                labelString: 'Utility tocken'
                            },
                            ticks: {
                                min: 0,
                                max: yLength,
                                stepSize: 1
                            }
                        }]
                    }
                }
            };
    
            window.onload = function() {
                var ctx = document.getElementById('canvas').getContext('2d');
                window.myLine = new Chart(ctx, config);
            };

            function update() {
                const seq = readNumbers()

                const golden = 0.62

                console.log('median')
                const avgs = calcAvg(seq, medianAlg.bind(null, 4))
                console.log(avgs);

                if (config.data.datasets.length === 0) {
                    return
                }

                const dataDot = []
                seq.blocks.forEach((b, i) => b.forEach(v => dataDot.push({
                    x: i, y: v,
                })));
                
                config.data.datasets[0].data = avgs
                config.data.datasets[1].data = dataDot

                const xLength = Array(avgs.length).keys()
                const yLength = Math.max.apply(null, dataDot.map(item => item.y).concat(avgs)) + 1
                config.data.labels = [...xLength]
                config.options.scales.yAxes[0].ticks.max = yLength
                window.myLine.update()
            }
        </script>
    </div>
</body>
